<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="app/css/main.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta charset="utf-8"/>
    <title>Welcome to OpenBroker</title>
</head>
<body>
<div>

    <div class="main-style">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<div class="entry">
  <h1>Welcome to OpenBroker, the imaginary brokerage.</h1>
    <div class="grid">
        <div id="login_failure_message" class="warning">
        </div>
        <div id="registration_failure_message" class="warning">
        </div>
        <div id="login">
            <div id="registration_success_message" class="success">
            </div>
                <div class="body">
                    Do you already have an imaginary account with OpenBroker?  Login here.
                </div>
                <div class="grid">
                    <div class="right-align">
                        Email address:
                    </div>
                    <div>
                        <input
                            type="email"
                            name="email_address"
                            id="login_email_address"
                            minlength="4"
                            required/>
                    </div>
                    <div class="right-align">Password:</div>
                    <div><input aria-label="Password" name="password" id="login_password" type="password"
                                     required autocomplete="current-password" minlength="1"
                                     maxlength="30" />
                        <span class="password-toggle-icon"><i id='login-password-toggle' class="fas fa-eye"></i></span>
                    </div>
                    <div> </div>

                    <div>
                        <input type="button" onclick="doLogin()" value="Login" />
                    </div>
                </div>
        </div>
        <div id="register">
                <div class="body">
                    Are you interested in opening an imaginary account with OpenBroker?  Register here.
                </div>
                <div class="grid">
                    <div class="right-align">
                        Offer code:
                    </div>
                    <div>
                        <input
                            type="text"
                            name="offer_code"
                            id="register_offer_code"
                            minlength="4"
                            required/>
                    </div>
                    <div class="right-align">
                        Name:
                    </div>
                    <div><input
                            type="text"
                            name="actor_name"
                            id="register_actor_name"
                            minlength="4"
                            required
                    />
                    </div>
                    <div class="right-align">
                        Email address:
                    </div>
                    <div><input
                            type="email"
                            name="email_address"
                            id="register_email_address"
                            minlength="4"
                            required
                    />
                    </div>
                    <div class="right-align">
                        Password:
                    </div>
                    <div><input aria-label="Password" name="password" id="register_password" type="password"
                                         required autocomplete="current-password" minlength="8"
                                         maxlength="30" />
                        <span class="password-toggle-icon"><i id='register-password-toggle' class="fas fa-eye"></i></span>
                    </div>
                    <div></div>
                    <div >
                        <input type="button" onclick="doRegister()" value="Register" />
                    </div>
                </div>
        </div>
    </div>
</div>
    <script src="app/js/login.js"></script>
    <script>
        function clearMessages() {
            document.getElementById("registration_success_message").innerHTML = "";
            document.getElementById("registration_failure_message").innerHTML = "";
            document.getElementById("login_failure_message").innerHTML = "";
        }
        function registerCallback(status, _) {
            // console.log("registerCallback, status = " + status);
            if (status === 201) {
                document.getElementById("registration_success_message").innerHTML =
                    "You have successfully registered and may now login.";
                document.getElementById("login_email_address").value =
                        document.getElementById("register_email_address").value;
                document.getElementById("register_offer_code").value = "";
                document.getElementById("register_actor_name").value = "";
                document.getElementById("register_email_address").value = "";
                document.getElementById("register_password").value = "";
            }
            else if (status === 404) {
                document.getElementById("registration_failure_message").innerHTML =
                        "You have entered an invalid offer code; please try again.";
            }
            else if (status === 406) {
                document.getElementById("registration_failure_message").innerHTML =
                        "You have entered invalid new credentials; please try again.";
            }
            else {
                document.getElementById("registration_failure_message").innerHTML =
                        "Your registration failed due to technical reasons; please try again.";
            }
        }

        function doRegister() {
            clearMessages();
            // console.log("doRegister");
            let offerCode = document.getElementById("register_offer_code").value;
            let actorName = document.getElementById("register_actor_name").value;
            let emailAddress = document.getElementById("register_email_address").value;
            let password = document.getElementById("register_password").value;
            register(offerCode, actorName, emailAddress, password, registerCallback);
        }

        function loginCallback(status, _) {
            document.getElementById("login_failure_message").innerHTML = "";
            // console.log("loginCallback, status = " + status);
            if (status === 200) {
                // console.log("redirecting to trading experience");
                window.location.href="/app";
            }
            else if (status === 401) {
                document.getElementById("login_failure_message").innerHTML =
                        "Your login credentials were invalid; please try again.";
            }
            else {
                document.getElementById("login_failure_message").innerHTML =
                        "Your login failed due to technical reasons; please try again.";
            }
        }

        function doLogin() {
            clearMessages();
            // console.log("doLogin");
            let emailAddress = document.getElementById("login_email_address").value;
            let password = document.getElementById("login_password").value;
            login(emailAddress, password, loginCallback);
        }

        attachPasswordToggle(document.getElementById("login_password"), document.getElementById("login-password-toggle"));
        attachPasswordToggle(document.getElementById("register_password"), document.getElementById("register-password-toggle"));

    </script>

    </div>
</div>
</body>
</html>
